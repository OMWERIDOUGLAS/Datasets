<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Population Map</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" >
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 0;
        }
        .wrapper {
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            justify-content: center;
            margin-top: 50px;
        }
        .sidebar {
            width: 550px;
            background-color: #fff;
            padding: 20px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            margin-right: 20px;
        }
        .sidebar h2 {
            margin-bottom: 20px;
            font-size: 24px;
            text-align: center;
            color: #333;
        }
        .sidebar label {
            font-size: 18px;
            color: #555;
            margin-bottom: 10px;
            display: block;
        }
        .map-container {
            flex: 1;
            background-color: #fff;
            padding: 20px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }
        svg {
            display: block;
            margin: auto;
            width: 100%;
        }
        .map-title {
            text-align: center;
            margin-bottom: 20px;
            font-size: 24px;
            color: #333;
        }
        input[type="range"] {
            width: 100%;
            -webkit-appearance: none;
            appearance: none;
            height: 10px;
            border-radius: 5px;
            background-color: #f0f0f0;
            outline: none;
            margin-bottom: 20px;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: #007bff;
            cursor: pointer;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: #007bff;
            cursor: pointer;
        }
        .year-labels {
            display: flex;
            justify-content: space-between;
            font-size: 16px;
            color: #555;
        }
        .key-container {
            width: 300px;
            background-color: #fff;
            padding: 20px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            margin-left: 20px;
        }
        .key-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .color-box {
            width: 20px;
            height: 20px;
            border-radius: 5px;
            margin-right: 10px;
        }
        .color-label {
            font-size: 16px;
            color: #555;
        }
        select {
    width: 100%;
    padding: 10px;
    border-radius: 5px;
    border: 1px solid #ccc;
    background-color: #fff;
    font-size: 16px;
    color: #555;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    background-image: url('data:image/svg+xml;utf8,<svg fill="black" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>'); /* add custom arrow icon */
    background-repeat: no-repeat;
    background-position: right 10px top 50%;
    background-size: 20px 20px;
}

/* Style select dropdown when hovered */
select:hover {
    border-color: #999;
}

/* Style select dropdown when focused */
select:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
}

/* Style select dropdown options */
select option {
    padding: 10px;
    background-color: #fff;
    color: #555;
}
.tooltip {
    position: absolute;
    background-color: rgba(41, 40, 40, 0.9); /* Semi-transparent white background */
    border: 1px solid #999; /* Border color */
    border-radius: 5px;
    color: white;
    padding: 10px;
    font-size: 16px; /* Increase font size */
    z-index: 9999; /* Ensure tooltip appears on top of other elements */
    pointer-events: none; /* Prevents tooltip from interfering with mouse events */
}

    </style>
</head>
<body>
    <div class="wrapper">
        <div class="sidebar">
            <h2>Interaction Panel</h2>
            <label  for="year-select">Select Year:</label>
            <select id="year-select">
                <option value="1980">1980</option>
                <option value="2000">2000</option>
                <option value="2010">2010</option>
                <option value="2022">2022</option>
                <option value="2023">2023</option>
                <option value="2030">2030</option>
                <option value="2050">2050</option>
            </select>
            <h2 style="margin-top: 30px;">Top 10 Countries by Density</h2>
            <table id="top-countries" class="table table-bordered">
              <thead>
                  <tr>
                      <th>No.</th>
                      <th>Country</th>
                      <th>Density (per kmÂ²)</th>
                  </tr>
              </thead>
              <tbody></tbody>
          </table>
        </div>
        <div class="map-container">
            <h2 class="map-title">World  Density Map</h2>
            <svg id="world-map" width="800" height="500"></svg>
        </div>

        <div class="key-container">
          <h2>Key</h2>
          <div class="key-item">
              <div class="color-box" style="background-color: #f7fbff;"></div>
              <span class="color-label">0 - 5</span>
          </div>
          <div class="key-item">
              <div class="color-box" style="background-color: #deebf7;"></div>
              <span class="color-label">5 - 10</span>
          </div>
          <div class="key-item">
              <div class="color-box" style="background-color: #c6dbef;"></div>
              <span class="color-label">10 - 30</span>
          </div>
          <div class="key-item">
              <div class="color-box" style="background-color: #9ecae1;"></div>
              <span class="color-label">30 - 50</span>
          </div>
          <div class="key-item">
              <div class="color-box" style="background-color: #6baed6;"></div>
              <span class="color-label">50 - 100</span>
          </div>
          <div class="key-item">
              <div class="color-box" style="background-color: #4292c6;"></div>
              <span class="color-label">100 - 200</span>
          </div>
          <div class="key-item">
              <div class="color-box" style="background-color: #2171b5;"></div>
              <span class="color-label">200 - 400</span>
          </div>
          <div class="key-item">
              <div class="color-box" style="background-color: #08519c;"></div>
              <span class="color-label">400 - 600</span>
          </div>
          <div class="key-item">
              <div class="color-box" style="background-color: #08306b;"></div>
              <span class="color-label">600 - 1000</span>
          </div>
          <div class="key-item">
              <div class="color-box" style="background-color: #08306b;"></div>
              <span class="color-label">1000 - 5000</span>
          </div>
          <div class="key-item">
              <div class="color-box" style="background-color: #08306b;"></div>
              <span class="color-label">5000 - 10000</span>
          </div>
          <div class="key-item">
              <div class="color-box" style="background-color: #08306b;"></div>
              <span class="color-label">10000+</span>
          </div>
      </div>
      
        </div>
    </div>
    

    <script src="https://d3js.org/d3.v6.js"></script>
    <script>
      const svg = d3.select("#world-map"),
          width = +svg.attr("width"),
          height = +svg.attr("height");
  
      const path = d3.geoPath();
      const projection = d3.geoMercator()
          .scale(150)
          .center([0, 20])
          .translate([width / 2, height / 2]);
  
      let data = new Map();
      const colorScale = d3.scaleThreshold()
    .domain([0, 5, 10, 30, 50, 100, 200, 400, 600, 1000, 5000, 10000]) // Adjusted density thresholds
    .range(["#f7fbff", "#deebf7", "#c6dbef", "#9ecae1", "#6baed6", "#4292c6", "#2171b5", "#08519c", "#08306b", "#08306b", "#08306b", "#08306b"]); // Adjusted color range

  
      let year = "density_per_km2_2023"; // Default year
  
      const tooltip = d3.select("body").append("div")
          .attr("class", "tooltip")
          .style("opacity", 0);

      let countryNames = new Map(); // Map to store country names

      // Load country names and codes
      d3.csv("density_per_km2.csv").then(function (namesData) {
        namesData.forEach(function (d) {
          countryNames.set(d.cca3, d.country);
        });
      });
  
      d3.csv("density_per_km2.csv", function (d) { // Update file name
          data.set(d.cca3, +d[year]);
          return null;
      }).then(function () {
          d3.json("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson")
              .then(function (topo) {
                  drawMap(topo);
              });
      });
  
      function drawMap(topo) {
          svg.selectAll("path")
              .data(topo.features)
              .join("path")
              .attr("d", d3.geoPath().projection(projection))
              .attr("fill", function (d) {
                  d.total = data.get(d.id) || 0;
                  return colorScale(d.total);
              })
              .on("mouseover", function (event, d) {
                  tooltip.transition()
                      .duration(200)
                      .style("opacity", .9);
                  tooltip.html(d.properties.name + "<br/> Density: " + (data.get(d.id) || "N/A")) // Update tooltip content
                      .style("left", (event.pageX) + "px")
                      .style("top", (event.pageY - 28) + "px");
              })
              .on("mouseout", function (d) {
                  tooltip.transition()
                      .duration(500)
                      .style("opacity", 0);
              });
      }
  
      document.getElementById('year-select').addEventListener('change', function () {
    year = "density_per_km2_" + this.value; // Update year variable
    updateMap();
    updateTopCountries();
});
      function updateMap() {
          d3.csv("density_per_km2.csv", function (d) { // Update file name
              data.set(d.cca3, +d[year]);
              return null;
          }).then(function () {
              d3.json("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson")
                  .then(function (topo) {
                      svg.selectAll("path")
                          .data(topo.features)
                          .join("path")
                          .attr("d", d3.geoPath().projection(projection))
                          .attr("fill", function (d) {
                              d.total = data.get(d.id) || 0;
                              return colorScale(d.total);
                          })
                          .on("mouseover", function (event, d) {
                              tooltip.transition()
                                  .duration(200)
                                  .style("opacity", .9);
                              tooltip.html(d.properties.name + "<br/> Density: " + (data.get(d.id) || "N/A")) // Update tooltip content
                                  .style("left", (event.pageX) + "px")
                                  .style("top", (event.pageY - 28) + "px");
                          })
                          .on("mouseout", function (d) {
                              tooltip.transition()
                                  .duration(500)
                                  .style("opacity", 0);
                          });
                  });
          });
      }
      function updateTopCountries() {
    // Sort countries by density
    let sortedCountries = Array.from(data.entries()).sort((a, b) => b[1] - a[1]);
    // Get top 10 countries
    let topCountries = sortedCountries.slice(0, 10);
    // Update the table body
    let tbody = document.querySelector('#top-countries tbody');
    tbody.innerHTML = '';
    topCountries.forEach((country, index) => {
        let row = document.createElement('tr');
        let rankCell = document.createElement('td');
        rankCell.textContent = index + 1;
        let countryCell = document.createElement('td');
        countryCell.textContent = countryNames.get(country[0]); // Get country name using country code
        let densityCell = document.createElement('td');
        densityCell.textContent = country[1];
        row.appendChild(rankCell);
        row.appendChild(countryCell);
        row.appendChild(densityCell);
        tbody.appendChild(row);
    });
}

    </script>
 
</body>
</html>
